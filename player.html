<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pigiama Party - Contestant</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    
    <style>
        /* === STILE GAME SHOW TELEVISIVO === */
        :root {
            --bg-primary: #0f0c29;
            --bg-secondary: #24243e;
            --accent-gold: #FFD700;
            --accent-blue: #00B4DB;
            --accent-purple: #8A2BE2;
            --accent-red: #FF416C;
            --accent-green: #00ff88;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0CC;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --neon-glow: 0 0 20px rgba(255, 215, 0, 0.7);
            --neon-glow-blue: 0 0 20px rgba(0, 180, 219, 0.7);
            --neon-glow-green: 0 0 20px rgba(0, 255, 136, 0.7);
            --neon-glow-red: 0 0 20px rgba(255, 65, 108, 0.7);
            --shadow-deep: 0 10px 40px rgba(0, 0, 0, 0.6);
            --border-radius: 12px;
            --border-radius-large: 20px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f0c29 0%, #24243e 50%, #302b63 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* SFONDO ANIMATO CON EFFETTI TV */
        .tv-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            overflow: hidden;
        }

        .scanlines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.1) 0px,
                rgba(0, 0, 0, 0.1) 1px,
                transparent 1px,
                transparent 2px
            );
            animation: scanlines 0.1s linear infinite;
        }

        .light-beams {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 180, 219, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(138, 43, 226, 0.2) 0%, transparent 50%);
            animation: lightMove 8s ease-in-out infinite;
        }

        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .particle {
            position: absolute;
            background: var(--accent-gold);
            border-radius: 50%;
            animation: float 6s infinite ease-in-out;
        }

        /* CONTAINER PRINCIPALE */
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* HEADER DRAMMATICO */
        .game-header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .main-title {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: var(--neon-glow);
            letter-spacing: 2px;
            animation: titleGlow 2s ease-in-out infinite alternate;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-weight: 500;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* CARD STILE TV SHOW */
        .tv-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(25px);
            border: 2px solid var(--glass-border);
            border-radius: var(--border-radius-large);
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-deep);
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
        }

        .tv-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .tv-card:hover::before {
            left: 100%;
        }

        /* GAME CODE STILE TELEVISIVO */
        .game-code {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            padding: 15px 30px;
            border: 2px solid var(--accent-gold);
            border-radius: var(--border-radius);
            display: inline-block;
            margin: 10px 0;
            box-shadow: var(--neon-glow);
            animation: codePulse 2s ease-in-out infinite;
        }

        /* BOTTONI STILE GAME SHOW */
        .game-btn {
            background: linear-gradient(135deg, var(--accent-gold), #FFA500);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 100%;
            justify-content: center;
            margin: 10px 0;
        }

        .game-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s ease;
        }

        .game-btn:hover::before {
            left: 100%;
        }

        .game-btn:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.6);
        }

        .game-btn:active:not(:disabled) {
            transform: translateY(-1px) scale(1.02);
        }

        .game-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* CAMPI INPUT STILE MODERNO */
        .input-field {
            padding: 15px 20px;
            margin: 10px 0;
            border: 2px solid var(--accent-blue);
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: var(--text-primary);
            font-size: 1rem;
            width: 100%;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent-gold);
            box-shadow: var(--neon-glow);
            background: rgba(255, 255, 255, 0.15);
        }

        /* QUESTION CARD STILE MILLIONAIRE */
        .question-container {
            background: linear-gradient(135deg, rgba(0, 180, 219, 0.2), rgba(138, 43, 226, 0.1));
            backdrop-filter: blur(25px);
            border: 3px solid var(--accent-blue);
            border-radius: var(--border-radius-large);
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: var(--neon-glow-blue);
            position: relative;
            overflow: hidden;
        }

        .question-text {
            font-size: 1.4rem;
            font-weight: 600;
            line-height: 1.4;
            margin: 20px 0;
            color: var(--text-primary);
            text-align: center;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        /* TIMER DRAMMATICO */
        .timer-container {
            text-align: center;
            margin: 25px 0;
            position: relative;
        }

        .timer {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transition: all 0.3s ease;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            position: relative;
            animation: timerPulse 1s ease-in-out infinite;
        }

        .timer.warning {
            background: linear-gradient(135deg, #FF416C, #FF4B2B);
            animation: timerDanger 0.5s ease-in-out infinite;
        }

        /* ANSWERS GRID STILE GAME SHOW */
        .answers-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 25px 0;
        }

        .answer-btn {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 20px;
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .answer-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .answer-btn:hover::before {
            left: 100%;
        }

        .answer-btn:hover {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.1));
            border-color: var(--accent-gold);
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--neon-glow);
        }

        .answer-btn.selected {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 165, 0, 0.2));
            border-color: var(--accent-gold);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
        }

        /* MESSAGGI DI ATTESA */
        .waiting-message {
            font-size: 1.3rem;
            color: var(--accent-blue);
            margin: 30px 0;
            font-weight: 600;
            text-align: center;
            text-shadow: 0 0 10px rgba(0, 180, 219, 0.5);
        }

        /* LEADERBOARD STILE TV SHOW */
        .leaderboard-container {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(0, 180, 219, 0.1));
            backdrop-filter: blur(25px);
            border: 3px solid var(--accent-gold);
            border-radius: var(--border-radius-large);
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: var(--neon-glow);
        }

        .leaderboard-title {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 25px;
            text-align: center;
            text-shadow: var(--neon-glow);
        }

        .leaderboard-list {
            list-style: none;
            margin: 20px 0;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .rank {
            font-weight: 700;
            width: 50px;
            text-align: center;
            font-size: 1.2rem;
        }

        .name {
            flex: 1;
            text-align: left;
            padding: 0 15px;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .score {
            font-weight: 800;
            color: var(--accent-gold);
            font-size: 1.3rem;
        }

        /* ANIMAZIONI SCHERMATE */
        .screen {
            animation: screenSlide 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .hidden {
            display: none !important;
        }

        /* VERSION INFO */
        .version {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-secondary);
            padding: 8px 15px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 100;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* AUDIO CONTROLS */
        .audio-controls {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 1000;
        }

        .audio-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid var(--accent-blue);
            color: var(--text-primary);
            padding: 8px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .audio-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--accent-gold);
        }

        /* SCHERMATA RISULTATO DOMANDA */
        .result-container {
            text-align: center;
            padding: 30px;
        }

        .result-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: resultBounce 0.6s ease;
        }

        .result-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .result-message {
            font-size: 1.3rem;
            color: var(--text-secondary);
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .points-earned {
            font-size: 2rem;
            font-weight: 800;
            margin: 20px 0;
            padding: 15px 30px;
            border-radius: var(--border-radius);
            display: inline-block;
        }

        .correct-result {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 180, 219, 0.1));
            border: 3px solid var(--accent-green);
            box-shadow: var(--neon-glow-green);
        }

        .correct-title {
            background: linear-gradient(135deg, var(--accent-green), #00B4DB);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .correct-points {
            background: linear-gradient(135deg, var(--accent-green), #00B4DB);
            color: #000;
            font-weight: 900;
        }

        .wrong-result {
            background: linear-gradient(135deg, rgba(255, 65, 108, 0.2), rgba(255, 75, 43, 0.1));
            border: 3px solid var(--accent-red);
            box-shadow: var(--neon-glow-red);
        }

        .wrong-title {
            background: linear-gradient(135deg, var(--accent-red), #FF9500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .wrong-points {
            background: linear-gradient(135deg, var(--accent-red), #FF9500);
            color: #000;
            font-weight: 900;
        }

        /* ANIMAZIONI */
        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(2px); }
        }

        @keyframes lightMove {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-15px) translateX(8px); }
            50% { transform: translateY(-8px) translateX(-8px); }
            75% { transform: translateY(-12px) translateX(12px); }
        }

        @keyframes titleGlow {
            0% { text-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }
            100% { text-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 45px rgba(255, 215, 0, 0.6); }
        }

        @keyframes codePulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }
            50% { transform: scale(1.02); box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
        }

        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes timerDanger {
            0%, 100% { 
                transform: scale(1);
                text-shadow: 0 0 20px rgba(255, 65, 108, 0.5);
            }
            50% { 
                transform: scale(1.1);
                text-shadow: 0 0 35px rgba(255, 65, 108, 0.8);
            }
        }

        @keyframes screenSlide {
            0% { opacity: 0; transform: translateX(30px); filter: blur(10px); }
            100% { opacity: 1; transform: translateX(0); filter: blur(0); }
        }

        @keyframes resultBounce {
            0% { transform: scale(0); opacity: 0; }
            60% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes confetti {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(500px) rotate(360deg); opacity: 0; }
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .main-title {
                font-size: 2rem;
            }
            
            .game-code {
                font-size: 1.8rem;
                padding: 12px 25px;
            }
            
            .tv-card, .question-container, .leaderboard-container {
                padding: 20px;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .timer {
                font-size: 2.8rem;
            }
            
            .game-btn {
                padding: 12px 25px;
                font-size: 1rem;
            }
            
            .result-icon {
                font-size: 4rem;
            }
            
            .result-title {
                font-size: 2rem;
            }
        }

        /* EFFETTO RISPOSTA CONFERMATA */
        .confirmation-box {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 180, 219, 0.1));
            border: 2px solid var(--accent-green);
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 20px 0;
            box-shadow: var(--neon-glow-green);
            text-align: center;
        }

        /* EFFETTO CONFETTI */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--accent-gold);
            opacity: 0;
            z-index: 1000;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- SFONDO ANIMATO TV SHOW -->
    <div class="tv-background">
        <div class="scanlines"></div>
        <div class="light-beams"></div>
        <div class="particles" id="particlesContainer"></div>
    </div>

    <!-- CONTROLLO AUDIO PLAYER -->
    <div class="audio-controls">
        <button class="audio-btn" id="sfxToggle">üîä SFX</button>
    </div>

    <div class="version">Game Show Contestant</div>
    
    <div class="container">
        <!-- SCHERMATA INIZIALE -->
        <div id="initialScreen" class="screen">
            <div class="game-header">
                <h1 class="main-title">üéÆ PIGIAMA PARTY</h1>
                <div class="subtitle">THE ULTIMATE GAME SHOW</div>
            </div>
            
            <div class="tv-card">
                <div style="text-align: center; margin-bottom: 25px;">
                    <div style="font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 15px; font-weight: 600;">
                        ENTER GAME SHOW DETAILS
                    </div>
                </div>
                
                <input type="text" id="gameCodeInput" class="input-field" placeholder="GAME CODE" maxlength="8">
                <input type="text" id="playerName" class="input-field" placeholder="CONTESTANT NAME" maxlength="20">
                
                <button class="game-btn" id="joinBtn">
                    <span>üéØ</span>
                    JOIN GAME SHOW
                </button>
            </div>
        </div>

        <!-- SCHERMATA ATTESA -->
        <div id="waitingScreen" class="screen hidden">
            <div class="game-header">
                <h1 class="main-title">‚è≥ READY TO PLAY</h1>
                <div class="subtitle">WAITING FOR HOST</div>
            </div>
            
            <div class="tv-card">
                <div class="game-code" id="gameCodeDisplay">SHOW123</div>
                <div class="waiting-message" id="waitingMessage">
                    Waiting for Game Master to start the show...
                </div>
                
                <div style="text-align: center; margin: 25px 0;">
                    <div class="confirmation-box">
                        <div style="font-weight: bold; font-size: 1.1rem;">CONTESTANT</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: var(--accent-gold);" id="playerNameDisplay">CONTESTANT NAME</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCHERMATA DOMANDA -->
        <div id="questionScreen" class="screen hidden">
            <div class="question-container">
                <div id="questionNumber" style="color: var(--accent-blue); font-weight: 700; margin-bottom: 15px; text-align: center; font-size: 1.1rem;">
                    QUESTION 1/10
                </div>
                <div class="question-text" id="questionText">The game show question will appear here...</div>
                
                <div class="timer-container">
                    <div class="timer" id="timer">30</div>
                </div>
                
                <div class="answers-container" id="answersContainer">
                    <!-- Le risposte appariranno qui -->
                </div>
                
                <button class="game-btn" id="submitBtn" disabled>
                    <span>üöÄ</span>
                    SUBMIT ANSWER
                </button>
            </div>
        </div>

        <!-- SCHERMATA RISPOSTA INVIATA -->
        <div id="answerSubmittedScreen" class="screen hidden">
            <div class="game-header">
                <h1 class="main-title">‚úÖ ANSWER SUBMITTED!</h1>
                <div class="subtitle">WAITING FOR OTHER CONTESTANTS</div>
            </div>
            
            <div class="tv-card">
                <div class="waiting-message">
                    Please wait while other contestants respond...
                </div>
                
                <div style="text-align: center; margin: 25px 0;">
                    <div class="confirmation-box">
                        <div style="font-weight: bold; font-size: 1.1rem;">YOUR ANSWER</div>
                        <div style="font-size: 1.4rem; font-weight: 700; color: var(--accent-gold); margin-top: 10px;" id="selectedAnswerText">SELECTED ANSWER</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCHERMATA RISULTATO DOMANDA -->
        <div id="questionResultScreen" class="screen hidden">
            <div class="tv-card" id="resultCard">
                <div class="result-container" id="resultContainer">
                    <!-- Il risultato verr√† mostrato qui -->
                </div>
            </div>
        </div>

        <!-- SCHERMATA CLASSIFICA -->
        <div id="leaderboardScreen" class="screen hidden">
            <div class="leaderboard-container">
                <h2 class="leaderboard-title">üèÜ FINAL STANDINGS</h2>
                
                <ul class="leaderboard-list" id="leaderboardList">
                    <!-- La classifica verr√† generata qui -->
                </ul>

                <div style="text-align: center; margin-top: 25px;">
                    <div class="confirmation-box">
                        <div style="font-weight: bold; font-size: 1.1rem;">YOUR FINAL SCORE</div>
                        <div style="font-size: 2rem; font-weight: 800; color: var(--accent-gold); margin-top: 10px;" id="playerScore">0 POINTS</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ELEMENTI AUDIO - CON NUOVI SUONI -->
    <audio id="clickSound" preload="auto">
        <source src="audio/Click.wav" type="audio/wav">
    </audio>
    <audio id="correctSound" preload="auto">
        <source src="audio/correct.mp3" type="audio/mpeg">
    </audio>
    <audio id="wrongSound" preload="auto">
        <source src="audio/Wrong.wav" type="audio/wav">
    </audio>
    <audio id="transitionSound" preload="auto">
        <source src="audio/transition.wav" type="audio/wav">
    </audio>
    <audio id="timerSound" preload="auto">
        <source src="audio/timer.wav" type="audio/wav">
    </audio>
    <audio id="submitSound" preload="auto">
        <source src="audio/start.mp3" type="audio/mpeg">
    </audio>
    <!-- NUOVI SUONI -->
    <audio id="applauseSound" preload="auto">
        <source src="audio/clap.wav" type="audio/wav">
    </audio>
    <audio id="fartSound" preload="auto">
        <source src="audio/fart.wav" type="audio/wav">
    </audio>

    <script>
        // === CREA PARTICELLE ANIMATE ===
        function createParticles() {
            const container = document.getElementById('particlesContainer');
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = Math.random() * 4 + 1;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                
                const colors = ['#FFD700', '#00B4DB', '#8A2BE2', '#FF416C'];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 4) + 's';
                
                container.appendChild(particle);
            }
        }

        // === CREA EFFETTO CONFETTI ===
        function createConfetti() {
            const colors = ['#FFD700', '#00B4DB', '#8A2BE2', '#FF416C', '#00ff88'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.width = (Math.random() * 10 + 5) + 'px';
                confetti.style.height = (Math.random() * 10 + 5) + 'px';
                confetti.style.animation = `confetti ${Math.random() * 2 + 1}s ease-out forwards`;
                confetti.style.animationDelay = (Math.random() * 0.5) + 's';
                document.body.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 2000);
            }
        }

        // === FORZA REFRESH CACHE ===
        console.log('üéÆ PLAYER Game Show Edition - Caricato: ' + new Date().toLocaleString());

        // === SISTEMA AUDIO AGGIORNATO ===
        const audio = {
            clickSound: document.getElementById('clickSound'),
            correctSound: document.getElementById('correctSound'),
            wrongSound: document.getElementById('wrongSound'),
            transitionSound: document.getElementById('transitionSound'),
            timerSound: document.getElementById('timerSound'),
            submitSound: document.getElementById('submitSound'),
            applauseSound: document.getElementById('applauseSound'),
            fartSound: document.getElementById('fartSound'),
            
            sfxEnabled: true,
            audioActivated: false,
            
            async activateAudio() {
                console.log('üéµ Attivazione audio player...');
                
                try {
                    this.clickSound.volume = 0.01;
                    await this.clickSound.play();
                    this.clickSound.pause();
                    this.clickSound.currentTime = 0;
                    
                    this.audioActivated = true;
                    console.log('üéµ Audio player attivato!');
                    
                } catch (error) {
                    console.error('‚ùå Errore attivazione audio player:', error);
                    this.audioActivated = true;
                }
            },
            
            async playSFX(type) {
                if (!this.sfxEnabled || !this.audioActivated) {
                    console.log('üîá SFX disabilitati o audio non attivato');
                    return;
                }
                
                try {
                    const sfx = this[type];
                    sfx.currentTime = 0;
                    
                    // Volume personalizzato per ogni suono
                    const volumes = {
                        clickSound: 0.6,
                        correctSound: 0.7,
                        wrongSound: 0.7,
                        transitionSound: 0.6,
                        timerSound: 0.5,
                        submitSound: 0.7,
                        applauseSound: 0.8,
                        fartSound: 0.9
                    };
                    
                    sfx.volume = volumes[type] || 0.6;
                    await sfx.play();
                    console.log('üîä SFX player:', type);
                } catch (error) {
                    console.error('‚ùå Errore SFX player:', error);
                }
            },
            
            toggleSFX() {
                this.sfxEnabled = !this.sfxEnabled;
                const toggleBtn = document.getElementById('sfxToggle');
                toggleBtn.textContent = this.sfxEnabled ? 'üîä SFX' : 'üîá SFX';
                console.log(this.sfxEnabled ? 'üîä Suoni player ON' : 'üîá Suoni player OFF');
            }
        };

        // === CONFIGURA FIREBASE ===
        const firebaseConfig = {
            apiKey: "AIzaSyC-RrLKSwfM-S5r1gD_RWdjWElWhkgp1vI",
            authDomain: "pigiamaparty2-b8d66.firebaseapp.com",
            databaseURL: "https://pigiamaparty2-b8d66-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "pigiamaparty2-b8d66",
            storageBucket: "pigiamaparty2-b8d66.firebasestorage.app",
            messagingSenderId: "300420666102",
            appId: "1:300420666102:web:4170ec1ba37673b88652d7"
        };

        // Inizializza Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // === VARIABILI DI STATO ===
        let gameCode = '';
        let playerName = '';
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let timeLeft = 30;
        let timer;
        let playerScore = 0;
        let currentQuestionData = null;

        // === ELEMENTI DOM ===
        const elements = {
            initialScreen: document.getElementById('initialScreen'),
            waitingScreen: document.getElementById('waitingScreen'),
            questionScreen: document.getElementById('questionScreen'),
            answerSubmittedScreen: document.getElementById('answerSubmittedScreen'),
            questionResultScreen: document.getElementById('questionResultScreen'),
            leaderboardScreen: document.getElementById('leaderboardScreen'),
            gameCodeInput: document.getElementById('gameCodeInput'),
            playerName: document.getElementById('playerName'),
            joinBtn: document.getElementById('joinBtn'),
            gameCodeDisplay: document.getElementById('gameCodeDisplay'),
            waitingMessage: document.getElementById('waitingMessage'),
            playerNameDisplay: document.getElementById('playerNameDisplay'),
            questionNumber: document.getElementById('questionNumber'),
            questionText: document.getElementById('questionText'),
            timer: document.getElementById('timer'),
            answersContainer: document.getElementById('answersContainer'),
            submitBtn: document.getElementById('submitBtn'),
            selectedAnswerText: document.getElementById('selectedAnswerText'),
            leaderboardList: document.getElementById('leaderboardList'),
            playerScore: document.getElementById('playerScore'),
            resultContainer: document.getElementById('resultContainer'),
            resultCard: document.getElementById('resultCard')
        };

        // === FUNZIONI PRINCIPALI ===
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            
            setTimeout(() => {
                const targetScreen = document.getElementById(screenId);
                if (targetScreen) {
                    targetScreen.classList.remove('hidden');
                    audio.playSFX('transitionSound');
                }
            }, 50);
        }

        function joinGame() {
            gameCode = elements.gameCodeInput.value.trim().toUpperCase();
            playerName = elements.playerName.value.trim();
            
            if (!gameCode || !playerName) {
                alert('Please enter both game code and your name!');
                return;
            }

            audio.playSFX('clickSound');
            
            elements.gameCodeDisplay.textContent = gameCode;
            elements.playerNameDisplay.textContent = playerName;
            
            database.ref('games/' + gameCode + '/players').push({
                name: playerName,
                joinedAt: Date.now()
            });

            // Ascolta quando l'host rivela le risposte
            database.ref('games/' + gameCode + '/answersRevealed').on('value', (snapshot) => {
                const answersRevealed = snapshot.val();
                if (answersRevealed && currentQuestionData) {
                    console.log('üéØ Risposte rivelate! Mostrando risultato...');
                    showQuestionResult();
                }
            });

            database.ref('games/' + gameCode).on('value', (snapshot) => {
                const game = snapshot.val();
                if (!game) {
                    alert('Game not found! Check the code.');
                    return;
                }

                if (game.status === 'started') {
                    currentQuestionIndex = game.currentQuestion || 0;
                    console.log(`üéÆ Player: Game started, question ${currentQuestionIndex + 1}`);
                    showQuestionScreen();
                } else if (game.status === 'ended') {
                    showLeaderboard(game.leaderboard || []);
                }
            });

            database.ref('games/' + gameCode + '/currentQuestionData').on('value', (snapshot) => {
                const question = snapshot.val();
                if (question) {
                    currentQuestionData = question;
                    showQuestion(question);
                }
            });

            database.ref('games/' + gameCode + '/leaderboard').on('value', (snapshot) => {
                const leaderboard = snapshot.val();
                if (leaderboard) {
                    console.log('üèÜ Leaderboard received:', leaderboard);
                    showLeaderboard(leaderboard);
                }
            });

            showScreen('waitingScreen');
        }

        function showQuestionScreen() {
            audio.playSFX('transitionSound');
            showScreen('questionScreen');
        }

        function showQuestion(question) {
            currentQuestionIndex = question.currentQuestion || currentQuestionIndex;
            currentQuestionData = question;
            
            console.log(`üìù Player: Showing question ${currentQuestionIndex + 1}`, question);
            
            selectedAnswer = null;
            elements.submitBtn.disabled = true;
            elements.submitBtn.textContent = 'SUBMIT ANSWER';
            
            elements.questionText.textContent = question.question;
            elements.questionNumber.textContent = `QUESTION ${currentQuestionIndex + 1}`;
            
            elements.answersContainer.innerHTML = '';
            question.answers.forEach((answer, index) => {
                const button = document.createElement('button');
                button.className = 'answer-btn';
                button.textContent = answer;
                button.onclick = () => selectAnswer(index, answer);
                elements.answersContainer.appendChild(button);
            });
            
            showScreen('questionScreen');
            startTimer();
        }

        function selectAnswer(index, answerText) {
            audio.playSFX('clickSound');
            
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            document.querySelectorAll('.answer-btn')[index].classList.add('selected');
            selectedAnswer = index;
            elements.submitBtn.disabled = false;
            
            elements.selectedAnswerText.textContent = answerText;
        }

        function submitAnswer() {
            if (selectedAnswer === null) return;
            
            audio.playSFX('submitSound');
            elements.submitBtn.disabled = true;
            elements.submitBtn.textContent = '‚úì SUBMITTED';
            
            const answerTime = 30 - timeLeft;
            console.log(`‚è±Ô∏è Answer time: ${answerTime}s (bonus: ${answerTime <= 5 ? 'YES' : 'NO'})`);
            
            database.ref('games/' + gameCode + '/answers').push({
                playerName: playerName,
                answerIndex: selectedAnswer,
                questionIndex: currentQuestionIndex,
                answerTime: answerTime
            });

            setTimeout(() => {
                showScreen('answerSubmittedScreen');
            }, 500);
        }

        function startTimer() {
            timeLeft = 30;
            elements.timer.textContent = timeLeft;
            elements.timer.classList.remove('warning');
            
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                elements.timer.textContent = timeLeft;
                
                if (timeLeft <= 10) {
                    elements.timer.classList.add('warning');
                    if (timeLeft <= 5) {
                        audio.playSFX('timerSound');
                    }
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    if (selectedAnswer !== null) {
                        submitAnswer();
                    } else {
                        showScreen('answerSubmittedScreen');
                    }
                }
            }, 1000);
        }

        // === NUOVA FUNZIONE: MOSTRA RISULTATO DOMANDA ===
        function showQuestionResult() {
            if (!currentQuestionData || selectedAnswer === null) return;
            
            const isCorrect = selectedAnswer === currentQuestionData.correct;
            const answerTime = 30 - timeLeft;
            const basePoints = currentQuestionData.points || 10;
            const speedBonus = (answerTime <= 5) ? (6 - answerTime) : 0;
            const totalPoints = isCorrect ? (basePoints + speedBonus) : 0;
            
            console.log(`üéØ Risultato: ${isCorrect ? 'CORRETTO' : 'SBAGLIATO'}, Punti: ${totalPoints}`);
            
            // Prepara il contenuto del risultato
            let resultHTML = '';
            
            if (isCorrect) {
                resultHTML = `
                    <div class="result-icon">üéâ</div>
                    <div class="result-title correct-title">CORRECT!</div>
                    <div class="result-message">Brilliant answer! You nailed it!</div>
                    <div class="points-earned correct-points">
                        +${totalPoints} POINTS
                        ${speedBonus > 0 ? `<div style="font-size: 1rem; margin-top: 5px;">‚ö° +${speedBonus} speed bonus!</div>` : ''}
                    </div>
                `;
                elements.resultCard.className = 'tv-card correct-result';
                
                // Effetti per risposta corretta
                audio.playSFX('applauseSound');
                createConfetti();
                
            } else {
                resultHTML = `
                    <div class="result-icon">üí®</div>
                    <div class="result-title wrong-title">WRONG!</div>
                    <div class="result-message">Better luck next time! The correct answer was: <strong>${currentQuestionData.answers[currentQuestionData.correct]}</strong></div>
                    <div class="points-earned wrong-points">
                        0 POINTS
                    </div>
                `;
                elements.resultCard.className = 'tv-card wrong-result';
                
                // Effetti per risposta sbagliata
                audio.playSFX('fartSound');
            }
            
            elements.resultContainer.innerHTML = resultHTML;
            showScreen('questionResultScreen');
            
            // Passa alla prossima domanda dopo 3 secondi
            setTimeout(() => {
                showScreen('waitingScreen');
            }, 3000);
        }

        function showLeaderboard(leaderboard) {
            if (!leaderboard || leaderboard.length === 0) {
                console.log('‚ùå Empty or invalid leaderboard');
                return;
            }
            
            audio.playSFX('transitionSound');
            
            console.log('üìä Showing leaderboard:', leaderboard);
            
            elements.leaderboardList.innerHTML = '';
            
            leaderboard.forEach((player, index) => {
                const li = document.createElement('li');
                li.className = 'leaderboard-item';
                
                let rankIcon = '';
                if (index === 0) rankIcon = 'ü•á ';
                else if (index === 1) rankIcon = 'ü•à ';
                else if (index === 2) rankIcon = 'ü•â ';
                
                li.innerHTML = `
                    <span class="rank">${rankIcon}${index + 1}¬∞</span>
                    <span class="name">${player.name}</span>
                    <span class="score">${player.score || 0}P</span>
                `;
                elements.leaderboardList.appendChild(li);
                
                if (player.name === playerName) {
                    playerScore = player.score || 0;
                    elements.playerScore.textContent = `${playerScore} POINTS`;
                }
            });
            
            showScreen('leaderboardScreen');
        }

        // === EVENT LISTENERS ===
        elements.joinBtn.addEventListener('click', joinGame);
        elements.submitBtn.addEventListener('click', submitAnswer);

        document.addEventListener('click', function initAudio() {
            if (!audio.audioActivated) {
                audio.activateAudio();
            }
        }, { once: true });

        document.getElementById('sfxToggle').addEventListener('click', function() {
            audio.toggleSFX();
        });

        elements.gameCodeInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') joinGame();
        });
        elements.playerName.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') joinGame();
        });

        // === INIZIALIZZAZIONE ===
        createParticles();
        console.log('üéÆ Player Game Show Edition ready!');
        
        setTimeout(() => {
            document.title = "Pigiama Party - Contestant";
        }, 100);
    </script>
</body>
</html>
