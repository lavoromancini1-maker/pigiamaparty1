<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pigiama Party - Player</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --pink: #ff00c8;
            --cyan: #00eaff;
            --purple: #7b2cff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Orbitron', sans-serif;
        }

        body {
            background: #000;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .screen {
            max-width: 500px;
            margin: 0 auto;
        }

        .hidden {
            display: none;
        }

        .logo {
            font-size: 2rem;
            background: linear-gradient(45deg, var(--pink), var(--cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 20px 0;
        }

        .login-form {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            border: 2px solid var(--cyan);
        }

        input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border: 1px solid var(--cyan);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 1.1rem;
        }

        .btn {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: linear-gradient(45deg, var(--pink), var(--purple));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .question-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--pink);
        }

        .question-text {
            font-size: 1.3rem;
            margin: 20px 0;
            line-height: 1.4;
        }

        .timer {
            font-size: 2.5rem;
            color: var(--cyan);
            margin: 20px 0;
            font-weight: bold;
        }

        .answers-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }

        .answer-btn {
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
        }

        .answer-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .result-feedback {
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            font-weight: bold;
        }

        .waiting {
            background: rgba(255, 255, 0, 0.2);
            border: 2px solid yellow;
            color: yellow;
        }
    </style>
</head>
<body>
    <!-- Schermata Login -->
    <div id="loginScreen" class="screen">
        <div class="logo">üéÆ PIGIAMA PARTY</div>
        <div style="margin-bottom: 20px; opacity: 0.8;">Inserisci il codice gioco dell'host</div>
        
        <div class="login-form">
            <input type="text" id="playerName" placeholder="Il tuo nome" maxlength="12">
            <input type="text" id="gameCodeInput" placeholder="Codice gioco (es: GAME1234)">
            <button class="btn" id="joinBtn">UNISCITI AL GIOCO</button>
        </div>
    </div>

    <!-- Schermata Attesa -->
    <div id="waitingScreen" class="screen hidden">
        <div class="logo">‚è≥ IN ATTESA</div>
        <div class="question-container">
            <div style="font-size: 4rem; margin: 20px 0;">üéØ</div>
            <div style="font-size: 1.2rem; margin: 10px 0;" id="playerWelcome">Giocatore</div>
            <div style="opacity: 0.8;">In attesa che l'host avvii il gioco...</div>
        </div>
    </div>

    <!-- Schermata Gioco -->
    <div id="gameScreen" class="screen hidden">
        <div class="question-container">
            <div id="questionCounter">DOMANDA 1/3</div>
            <div class="question-text" id="questionText">La domanda apparir√† qui...</div>
            <div class="timer" id="timer">20</div>
            
            <div class="answers-container" id="answersContainer">
                <!-- Le risposte appariranno qui -->
            </div>
            
            <div id="resultFeedback"></div>
        </div>
    </div>

    <script>
        // VARIABILI DI STATO
        let playerState = {
            name: '',
            connected: false,
            currentQuestion: null,
            answered: false
        };

        // ELEMENTI DOM
        const screens = {
            login: document.getElementById('loginScreen'),
            waiting: document.getElementById('waitingScreen'),
            game: document.getElementById('gameScreen')
        };

        const elements = {
            playerName: document.getElementById('playerName'),
            gameCodeInput: document.getElementById('gameCodeInput'),
            joinBtn: document.getElementById('joinBtn'),
            playerWelcome: document.getElementById('playerWelcome'),
            questionCounter: document.getElementById('questionCounter'),
            questionText: document.getElementById('questionText'),
            timer: document.getElementById('timer'),
            answersContainer: document.getElementById('answersContainer'),
            resultFeedback: document.getElementById('resultFeedback')
        };

        // UNISCITI AL GIOCO
        elements.joinBtn.addEventListener('click', joinGame);

        function joinGame() {
            const name = elements.playerName.value.trim();
            const gameCode = elements.gameCodeInput.value.trim().toUpperCase();
            
            if (!name || !gameCode) {
                alert('Inserisci nome e codice gioco!');
                return;
            }

            playerState.name = name;
            elements.playerWelcome.textContent = name;

            // Connetti al gioco
            connectToGame(name, gameCode);
        }

        function connectToGame(playerName, gameCode) {
            // Leggi i player attuali
            let connectedPlayers = JSON.parse(localStorage.getItem('connectedPlayers') || '[]');
            
            // Aggiungi questo player
            if (!connectedPlayers.find(p => p.name === playerName)) {
                connectedPlayers.push({ name: playerName, gameCode: gameCode });
                localStorage.setItem('connectedPlayers', JSON.stringify(connectedPlayers));
            }

            // Mostra schermata attesa
            screens.login.classList.add('hidden');
            screens.waiting.classList.remove('hidden');
            
            // Inizia ad ascoltare
            startListening();
        }

        // ASCOLTA L'HOST
        function startListening() {
            setInterval(() => {
                // Controlla se il gioco √® iniziato
                const gameStatus = localStorage.getItem('gameStatus');
                if (gameStatus === 'started') {
                    screens.waiting.classList.add('hidden');
                    screens.game.classList.remove('hidden');
                    
                    // Controlla se c'√® una nuova domanda
                    const currentQuestionIndex = localStorage.getItem('currentQuestion');
                    const questionData = localStorage.getItem('currentQuestionData');
                    
                    if (questionData && !playerState.answered) {
                        const question = JSON.parse(questionData);
                        if (question && (!playerState.currentQuestion || playerState.currentQuestion.index != currentQuestionIndex)) {
                            loadQuestion(question, parseInt(currentQuestionIndex));
                        }
                    }
                }
            }, 1000);
        }

        function loadQuestion(questionData, questionIndex) {
            playerState.answered = false;
            playerState.currentQuestion = { ...questionData, index: questionIndex };
            
            // Aggiorna UI
            elements.questionCounter.textContent = `DOMANDA ${questionIndex + 1}/3`;
            elements.questionText.textContent = questionData.question;
            elements.resultFeedback.innerHTML = '';
            
            // Carica risposte
            loadAnswers(questionData);
            
            // Avvia timer
            startTimer();
        }

        function loadAnswers(question) {
            elements.answersContainer.innerHTML = '';
            
            question.answers.forEach((answer, index) => {
                const button = document.createElement('button');
                button.className = 'answer-btn';
                button.textContent = answer;
                button.addEventListener('click', () => selectAnswer(index));
                elements.answersContainer.appendChild(button);
            });
        }

        function startTimer() {
            let timeLeft = 20;
            elements.timer.textContent = timeLeft;
            
            const timerInterval = setInterval(() => {
                timeLeft--;
                elements.timer.textContent = timeLeft;
                
                if (timeLeft <= 0 || playerState.answered) {
                    clearInterval(timerInterval);
                    if (!playerState.answered) {
                        handleTimeUp();
                    }
                }
            }, 1000);
        }

        function selectAnswer(selectedIndex) {
            if (playerState.answered) return;
            
            playerState.answered = true;
            
            // Disabilita tutti i pulsanti
            const answerButtons = elements.answersContainer.querySelectorAll('.answer-btn');
            answerButtons.forEach(button => {
                button.disabled = true;
            });
            
            // Invia risposta all'host
            let answers = JSON.parse(localStorage.getItem('playerAnswers') || '[]');
            answers.push({
                playerName: playerState.name,
                answerIndex: selectedIndex,
                questionIndex: playerState.currentQuestion.index,
                timestamp: Date.now()
            });
            localStorage.setItem('playerAnswers', JSON.stringify(answers));
            
            // Mostra feedback
            elements.resultFeedback.innerHTML = `
                <div class="result-feedback waiting">
                    ‚úÖ RISPOSTA INVIATA!
                </div>
            `;
        }

        function handleTimeUp() {
            if (playerState.answered) return;
            
            playerState.answered = true;
            const answerButtons = elements.answersContainer.querySelectorAll('.answer-btn');
            
            answerButtons.forEach(button => {
                button.disabled = true;
            });
            
            elements.resultFeedback.innerHTML = `
                <div class="result-feedback" style="background: rgba(255,0,0,0.2); border-color: red; color: red;">
                    ‚è∞ TEMPO SCADUTO!
                </div>
            `;
        }

        console.log('‚úÖ Player pronto');
    </script>
</body>
</html>
