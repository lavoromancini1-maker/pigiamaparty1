<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pigiama Party - Contestant</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    
    <style>
        /* === STILE GAME SHOW TELEVISIVO === */
        :root {
            --bg-primary: #0f0c29;
            --bg-secondary: #24243e;
            --accent-gold: #FFD700;
            --accent-blue: #00B4DB;
            --accent-purple: #8A2BE2;
            --accent-red: #FF416C;
            --accent-green: #00ff88;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0CC;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --neon-glow: 0 0 20px rgba(255, 215, 0, 0.7);
            --neon-glow-blue: 0 0 20px rgba(0, 180, 219, 0.7);
            --neon-glow-green: 0 0 20px rgba(0, 255, 136, 0.7);
            --neon-glow-red: 0 0 20px rgba(255, 65, 108, 0.7);
            --shadow-deep: 0 10px 40px rgba(0, 0, 0, 0.6);
            --border-radius: 12px;
            --border-radius-large: 20px;
        }

        /* === TEMI DINAMICI === */
        body.theme-space {
            background: linear-gradient(135deg, #000428 0%, #004e92 100%);
            --accent-gold: #4FC3F7;
            --accent-blue: #E040FB;
            --accent-purple: #7B1FA2;
            --accent-green: #00E5FF;
        }

        body.theme-neon {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            --accent-gold: #00FFFF;
            --accent-blue: #FF00FF;
            --accent-purple: #FF6B6B;
            --accent-green: #39FF14;
        }

        body.theme-royal {
            background: linear-gradient(135deg, #3a1c71 0%, #d76d77 50%, #ffaf7b 100%);
            --accent-gold: #FFE082;
            --accent-blue: #80DEEA;
            --accent-purple: #CE93D8;
            --accent-green: #80CBC4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f0c29 0%, #24243e 50%, #302b63 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        /* SFONDO ANIMATO CON EFFETTI TV */
        .tv-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            overflow: hidden;
        }

        .scanlines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.1) 0px,
                rgba(0, 0, 0, 0.1) 1px,
                transparent 1px,
                transparent 2px
            );
            animation: scanlines 0.1s linear infinite;
        }

        .light-beams {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 180, 219, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(138, 43, 226, 0.2) 0%, transparent 50%);
            animation: lightMove 8s ease-in-out infinite;
        }

        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: var(--accent-gold);
            border-radius: 50%;
            animation: float 6s infinite ease-in-out;
            pointer-events: none;
        }

        /* PARTICELLE CELEBRAZIONE */
        .celebration-particle {
            position: fixed;
            width: 8px;
            height: 8px;
            background: var(--accent-gold);
            border-radius: 50%;
            pointer-events: none;
            z-index: 1000;
            animation: celebrate 1.5s ease-out forwards;
        }

        .confetti {
            position: fixed;
            width: 12px;
            height: 12px;
            background: var(--accent-gold);
            pointer-events: none;
            z-index: 1000;
            animation: confettiFall 3s ease-in forwards;
        }

        /* CONTAINER PRINCIPALE */
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* HEADER DRAMMATICO */
        .game-header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .main-title {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: var(--neon-glow);
            letter-spacing: 2px;
            animation: titleGlow 2s ease-in-out infinite alternate;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-weight: 500;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* CARD STILE TV SHOW */
        .tv-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(25px);
            border: 2px solid var(--glass-border);
            border-radius: var(--border-radius-large);
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-deep);
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
        }

        .tv-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .tv-card:hover::before {
            left: 100%;
        }

        /* GAME CODE STILE TELEVISIVO */
        .game-code {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            padding: 15px 30px;
            border: 2px solid var(--accent-gold);
            border-radius: var(--border-radius);
            display: inline-block;
            margin: 10px 0;
            box-shadow: var(--neon-glow);
            animation: codePulse 2s ease-in-out infinite;
        }

        /* BOTTONI STILE GAME SHOW */
        .game-btn {
            background: linear-gradient(135deg, var(--accent-gold), #FFA500);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 100%;
            justify-content: center;
            margin: 10px 0;
        }

        .game-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s ease;
        }

        .game-btn:hover::before {
            left: 100%;
        }

        .game-btn:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.6);
        }

        .game-btn:active:not(:disabled) {
            transform: translateY(-1px) scale(1.02);
        }

        .game-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* CAMPI INPUT STILE MODERNO */
        .input-field {
            padding: 15px 20px;
            margin: 10px 0;
            border: 2px solid var(--accent-blue);
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: var(--text-primary);
            font-size: 1rem;
            width: 100%;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent-gold);
            box-shadow: var(--neon-glow);
            background: rgba(255, 255, 255, 0.15);
        }

        /* QUESTION CARD STILE MILLIONAIRE */
        .question-container {
            background: linear-gradient(135deg, rgba(0, 180, 219, 0.2), rgba(138, 43, 226, 0.1));
            backdrop-filter: blur(25px);
            border: 3px solid var(--accent-blue);
            border-radius: var(--border-radius-large);
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: var(--neon-glow-blue);
            position: relative;
            overflow: hidden;
        }

        .question-text {
            font-size: 1.4rem;
            font-weight: 600;
            line-height: 1.4;
            margin: 20px 0;
            color: var(--text-primary);
            text-align: center;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        /* TIMER DRAMMATICO */
        .timer-container {
            text-align: center;
            margin: 25px 0;
            position: relative;
        }

        .timer {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transition: all 0.3s ease;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            position: relative;
            animation: timerPulse 1s ease-in-out infinite;
        }

        /* ANSWERS GRID STILE GAME SHOW */
        .answers-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 25px 0;
        }

        .answer-btn {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 20px;
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .answer-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .answer-btn:hover::before {
            left: 100%;
        }

        .answer-btn:hover {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.1));
            border-color: var(--accent-gold);
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--neon-glow);
        }

        .answer-btn.selected {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 165, 0, 0.2));
            border-color: var(--accent-gold);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
        }

        .answer-btn.auto-submitted {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 180, 219, 0.1));
            border-color: var(--accent-green);
            animation: pulseGlow 1s ease-in-out;
        }

        /* MESSAGGI DI ATTESA */
        .waiting-message {
            font-size: 1.3rem;
            color: var(--accent-blue);
            margin: 30px 0;
            font-weight: 600;
            text-align: center;
            text-shadow: 0 0 10px rgba(0, 180, 219, 0.5);
        }

        /* LEADERBOARD STILE TV SHOW */
        .leaderboard-container {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(0, 180, 219, 0.1));
            backdrop-filter: blur(25px);
            border: 3px solid var(--accent-gold);
            border-radius: var(--border-radius-large);
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: var(--neon-glow);
        }

        .leaderboard-title {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 25px;
            text-align: center;
            text-shadow: var(--neon-glow);
        }

        .leaderboard-list {
            list-style: none;
            margin: 20px 0;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .rank {
            font-weight: 700;
            width: 50px;
            text-align: center;
            font-size: 1.2rem;
        }

        .name {
            flex: 1;
            text-align: left;
            padding: 0 15px;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .score {
            font-weight: 800;
            color: var(--accent-gold);
            font-size: 1.3rem;
        }

        /* ANIMAZIONI SCHERMATE */
        .screen {
            animation: screenSlide 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .hidden {
            display: none !important;
        }

        /* VERSION INFO */
        .version {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-secondary);
            padding: 8px 15px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 100;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

/* AUDIO CONTROLS */
.audio-controls {
    position: fixed;
    top: 15px;
    left: 15px; /* CAMBIATO DA right A left */
    z-index: 1000;
    display: flex;
    gap: 8px;
}

        .audio-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid var(--accent-blue);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .audio-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--accent-gold);
        }

        /* SCHERMATA RISULTATO DOMANDA */
        .result-container {
            text-align: center;
            padding: 30px;
        }

        .result-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: resultBounce 0.6s ease;
        }

        .result-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .result-message {
            font-size: 1.3rem;
            color: var(--text-secondary);
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .points-earned {
            font-size: 2rem;
            font-weight: 800;
            margin: 20px 0;
            padding: 15px 30px;
            border-radius: var(--border-radius);
            display: inline-block;
        }

        .correct-result {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 180, 219, 0.1));
            border: 3px solid var(--accent-green);
            box-shadow: var(--neon-glow-green);
        }

        .correct-title {
            background: linear-gradient(135deg, var(--accent-green), #00B4DB);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .correct-points {
            background: linear-gradient(135deg, var(--accent-green), #00B4DB);
            color: #000;
            font-weight: 900;
        }

        .wrong-result {
            background: linear-gradient(135deg, rgba(255, 65, 108, 0.2), rgba(255, 75, 43, 0.1));
            border: 3px solid var(--accent-red);
            box-shadow: var(--neon-glow-red);
        }

        .wrong-title {
            background: linear-gradient(135deg, var(--accent-red), #FF9500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .wrong-points {
            background: linear-gradient(135deg, var(--accent-red), #FF9500);
            color: #000;
            font-weight: 900;
        }

        /* ANIMAZIONI */
        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(2px); }
        }

        @keyframes lightMove {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-15px) translateX(8px); }
            50% { transform: translateY(-8px) translateX(-8px); }
            75% { transform: translateY(-12px) translateX(12px); }
        }

        @keyframes titleGlow {
            0% { text-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }
            100% { text-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 45px rgba(255, 215, 0, 0.6); }
        }

        @keyframes codePulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }
            50% { transform: scale(1.02); box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
        }

        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes screenSlide {
            0% { opacity: 0; transform: translateX(30px); filter: blur(10px); }
            100% { opacity: 1; transform: translateX(0); filter: blur(0); }
        }

        @keyframes resultBounce {
            0% { transform: scale(0); opacity: 0; }
            60% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes pulseGlow {
            0% { box-shadow: 0 0 0px rgba(0, 255, 136, 0.5); }
            50% { box-shadow: 0 0 20px rgba(0, 255, 136, 0.8); }
            100% { box-shadow: 0 0 0px rgba(0, 255, 136, 0.5); }
        }

        /* NUOVE ANIMAZIONI */
        @keyframes celebrate {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx, 0), var(--ty, -100px)) scale(0);
                opacity: 0;
            }
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes themeTransition {
            0% { filter: brightness(1) blur(0px); }
            50% { filter: brightness(1.2) blur(5px); }
            100% { filter: brightness(1) blur(0px); }
        }

        /* EFFETTO RISPOSTA CONFERMATA */
        .confirmation-box {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 180, 219, 0.1));
            border: 2px solid var(--accent-green);
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 20px 0;
            box-shadow: var(--neon-glow-green);
            text-align: center;
        }

        /* MESSAGGIO ATTESA HOST */
        .waiting-host-message {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-top: 20px;
            font-style: italic;
            text-align: center;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .main-title {
                font-size: 2rem;
            }
            
            .game-code {
                font-size: 1.8rem;
                padding: 12px 25px;
            }
            
            .tv-card, .question-container, .leaderboard-container {
                padding: 20px;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .timer {
                font-size: 2.8rem;
            }
            
            .game-btn {
                padding: 12px 25px;
                font-size: 1rem;
            }
            
            .result-icon {
                font-size: 4rem;
            }
            
            .result-title {
                font-size: 2rem;
            }

    .audio-controls {
        top: 15px;
        left: 15px; /* CAMBIATO */
        right: auto;
        transform: none;
        flex-direction: row; /* CAMBIATO DA column A row */
    }

                    /* === STILE DRAG-AND-DROP PER ORDINE CRONOLOGICO === */
        .drag-drop-container {
            margin: 20px 0;
        }

        .draggable-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .draggable-item {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 18px 20px;
            margin: 12px 0;
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: grab;
            transition: all 0.3s ease;
            position: relative;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .draggable-item::before {
            content: '‚â°';
            font-size: 1.4rem;
            color: var(--accent-gold);
            opacity: 0.7;
        }

        .draggable-item:hover {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.1));
            border-color: var(--accent-gold);
            transform: translateX(5px);
        }

        .draggable-item.dragging {
            opacity: 0.8;
            transform: rotate(3deg);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            cursor: grabbing;
        }

        .draggable-item.dragging::before {
            opacity: 1;
        }

        .drag-over {
            border: 2px dashed var(--accent-gold);
            background: rgba(255, 215, 0, 0.1);
        }

        .order-indicator {
            background: var(--accent-blue);
            color: #000;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .drag-instructions {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 20px;
            font-style: italic;
        }

        .submit-order-btn {
            background: linear-gradient(135deg, var(--accent-green), #00B4DB);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4);
            margin-top: 20px;
            width: 100%;
            justify-content: center;
        }

        .submit-order-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.6);
        }

        .submit-order-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        }
    </style>
</head>
<body>
    <!-- SFONDO ANIMATO TV SHOW -->
    <div class="tv-background">
        <div class="scanlines"></div>
        <div class="light-beams"></div>
        <div class="particles" id="particlesContainer"></div>
    </div>

    <!-- CONTROLLO AUDIO PLAYER -->
    <div class="audio-controls">
        <button class="audio-btn" id="sfxToggle">üîä SFX</button>
    </div>

    <div class="version">Game Show Contestant v2.0</div>
    
    <div class="container">
        <!-- SCHERMATA INIZIALE -->
        <div id="initialScreen" class="screen">
            <div class="game-header">
                <h1 class="main-title">üéÆ PIGIAMA PARTY</h1>
                <div class="subtitle">THE ULTIMATE GAME SHOW</div>
            </div>
            
            <div class="tv-card">
                <div style="text-align: center; margin-bottom: 25px;">
                    <div style="font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 15px; font-weight: 600;">
                        ENTER GAME SHOW DETAILS
                    </div>
                </div>
                
                <input type="text" id="gameCodeInput" class="input-field" placeholder="GAME CODE" maxlength="8">
                <input type="text" id="playerName" class="input-field" placeholder="CONTESTANT NAME" maxlength="20">
                
                <button class="game-btn" id="joinBtn">
                    <span>üéØ</span>
                    JOIN GAME SHOW
                </button>
            </div>
        </div>

        <!-- SCHERMATA ATTESA -->
        <div id="waitingScreen" class="screen hidden">
            <div class="game-header">
                <h1 class="main-title">‚è≥ READY TO PLAY</h1>
                <div class="subtitle">WAITING FOR HOST</div>
            </div>
            
            <div class="tv-card">
                <div class="game-code" id="gameCodeDisplay">SHOW123</div>
                <div class="waiting-message" id="waitingMessage">
                    Waiting for Game Master to start the show...
                </div>
                
                <div style="text-align: center; margin: 25px 0;">
                    <div class="confirmation-box">
                        <div style="font-weight: bold; font-size: 1.1rem;">CONTESTANT</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: var(--accent-gold);" id="playerNameDisplay">CONTESTANT NAME</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCHERMATA DOMANDA -->
        <div id="questionScreen" class="screen hidden">
            <div class="question-container">
                <div id="questionNumber" style="color: var(--accent-blue); font-weight: 700; margin-bottom: 15px; text-align: center; font-size: 1.1rem;">
                    QUESTION 1/10
                </div>
                <div class="question-text" id="questionText">The game show question will appear here...</div>
                
                <div class="timer-container">
                    <div class="timer" id="timer">20</div>
                </div>
                
                <div class="answers-container" id="answersContainer">
                    <!-- Le risposte appariranno qui -->
                </div>
            </div>
        </div>

        <!-- SCHERMATA RISPOSTA INVIATA -->
        <div id="answerSubmittedScreen" class="screen hidden">
            <div class="game-header">
                <h1 class="main-title">‚úÖ ANSWER SUBMITTED!</h1>
                <div class="subtitle">WAITING FOR OTHER CONTESTANTS</div>
            </div>
            
            <div class="tv-card">
                <div class="waiting-message">
                    Please wait while other contestants respond...
                </div>
                
                <div style="text-align: center; margin: 25px 0;">
                    <div class="confirmation-box">
                        <div style="font-weight: bold; font-size: 1.1rem;">YOUR ANSWER</div>
                        <div style="font-size: 1.4rem; font-weight: 700; color: var(--accent-gold); margin-top: 10px;" id="selectedAnswerText">SELECTED ANSWER</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCHERMATA RISULTATO DOMANDA -->
        <div id="questionResultScreen" class="screen hidden">
            <div class="tv-card" id="resultCard">
                <div class="result-container" id="resultContainer">
                    <!-- Il risultato verr√† mostrato qui -->
                </div>
                <div class="waiting-host-message" id="waitingHostMessage">
                    Waiting for host to start next question...
                </div>
            </div>
        </div>

        <!-- SCHERMATA CLASSIFICA -->
        <div id="leaderboardScreen" class="screen hidden">
            <div class="leaderboard-container">
                <h2 class="leaderboard-title">üèÜ FINAL STANDINGS</h2>
                
                <ul class="leaderboard-list" id="leaderboardList">
                    <!-- La classifica verr√† generata qui -->
                </ul>

                <div style="text-align: center; margin-top: 25px;">
                    <div class="confirmation-box">
                        <div style="font-weight: bold; font-size: 1.1rem;">YOUR FINAL SCORE</div>
                        <div style="font-size: 2rem; font-weight: 800; color: var(--accent-gold); margin-top: 10px;" id="playerScore">0 POINTS</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ELEMENTI AUDIO -->
    <audio id="clickSound" preload="auto">
        <source src="audio/Click.wav" type="audio/wav">
    </audio>
    <audio id="correctSound" preload="auto">
        <source src="audio/correct.mp3" type="audio/mpeg">
    </audio>
    <audio id="wrongSound" preload="auto">
        <source src="audio/Wrong.wav" type="audio/wav">
    </audio>
    <audio id="transitionSound" preload="auto">
        <source src="audio/transition.wav" type="audio/wav">
    </audio>
    <audio id="timerSound" preload="auto">
        <source src="audio/timer.wav" type="audio/wav">
    </audio>
    <audio id="submitSound" preload="auto">
        <source src="audio/start.mp3" type="audio/mpeg">
    </audio>
    <audio id="applauseSound" preload="auto">
        <source src="audio/clap.wav" type="audio/wav">
    </audio>
    <audio id="fartSound" preload="auto">
        <source src="audio/fart.wav" type="audio/wav">
    </audio>

    <script>
        // === CREA PARTICELLE ANIMATE ===
        function createParticles() {
            const container = document.getElementById('particlesContainer');
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = Math.random() * 4 + 1;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                
                const colors = ['var(--accent-gold)', 'var(--accent-blue)', 'var(--accent-purple)', '#FF416C'];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 4) + 's';
                
                container.appendChild(particle);
            }
        }

        // === PARTICELLE DI CELEBRAZIONE ===
        function createCelebrationParticles(x, y, count = 20) {
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'celebration-particle';
                
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                
                const angle = Math.random() * Math.PI * 2;
                const distance = 50 + Math.random() * 100;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                
                particle.style.setProperty('--tx', tx + 'px');
                particle.style.setProperty('--ty', ty + 'px');
                
                const colors = ['var(--accent-gold)', 'var(--accent-blue)', 'var(--accent-purple)', '#FF416C', '#00FF00'];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                const size = 3 + Math.random() * 8;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                
                document.body.appendChild(particle);
                
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 1500);
            }
        }

        // === CONFETTI PER VITTORIA ===
        function createConfetti() {
            const confettiCount = 50;
            
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-20px';
                
                const colors = ['var(--accent-gold)', 'var(--accent-blue)', 'var(--accent-purple)', '#FF416C', '#00FF00', '#FFFF00'];
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                if (Math.random() > 0.5) {
                    confetti.style.borderRadius = '50%';
                } else {
                    confetti.style.borderRadius = '2px';
                }
                
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                
                const duration = 2 + Math.random() * 2;
                confetti.style.animationDuration = duration + 's';
                
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    if (confetti.parentNode) {
                        confetti.parentNode.removeChild(confetti);
                    }
                }, duration * 1000);
            }
        }

        // === CAMBIO TEMA DINAMICO ===
        function changeTheme(themeName) {
            const body = document.body;
            const themeButtons = document.querySelectorAll('.theme-btn');
            
            body.className = body.className.replace(/theme-\w+/g, '');
            
            if (themeName !== 'default') {
                body.classList.add('theme-' + themeName);
            }
            
            themeButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === themeName);
            });
            
            body.style.animation = 'themeTransition 0.8s ease';
            setTimeout(() => {
                body.style.animation = '';
            }, 800);

            const particlesContainer = document.getElementById('particlesContainer');
            particlesContainer.innerHTML = '';
            createParticles();
        }

        // === FORZA REFRESH CACHE ===
        console.log('üéÆ PLAYER Game Show Edition v2.0 - Caricato: ' + new Date().toLocaleString());

        // === SISTEMA AUDIO AGGIORNATO ===
        const audio = {
            clickSound: document.getElementById('clickSound'),
            correctSound: document.getElementById('correctSound'),
            wrongSound: document.getElementById('wrongSound'),
            transitionSound: document.getElementById('transitionSound'),
            timerSound: document.getElementById('timerSound'),
            submitSound: document.getElementById('submitSound'),
            applauseSound: document.getElementById('applauseSound'),
            fartSound: document.getElementById('fartSound'),
            
            sfxEnabled: true,
            audioActivated: false,
            
            async activateAudio() {
                console.log('üéµ Attivazione audio player...');
                
                try {
                    this.clickSound.volume = 0.01;
                    await this.clickSound.play();
                    this.clickSound.pause();
                    this.clickSound.currentTime = 0;
                    
                    this.audioActivated = true;
                    console.log('üéµ Audio player attivato!');
                    
                } catch (error) {
                    console.error('‚ùå Errore attivazione audio player:', error);
                    this.audioActivated = true;
                }
            },
            
            async playSFX(type) {
                if (!this.sfxEnabled || !this.audioActivated) {
                    console.log('üîá SFX disabilitati o audio non attivato');
                    return;
                }
                
                try {
                    const sfx = this[type];
                    sfx.currentTime = 0;
                    
                    const volumes = {
                        clickSound: 0.6,
                        correctSound: 0.7,
                        wrongSound: 0.7,
                        transitionSound: 0.6,
                        timerSound: 0.5,
                        submitSound: 0.7,
                        applauseSound: 0.8,
                        fartSound: 0.9
                    };
                    
                    sfx.volume = volumes[type] || 0.6;
                    await sfx.play();
                    console.log('üîä SFX player:', type);
                } catch (error) {
                    console.error('‚ùå Errore SFX player:', error);
                }
            },
            
            toggleSFX() {
                this.sfxEnabled = !this.sfxEnabled;
                const toggleBtn = document.getElementById('sfxToggle');
                toggleBtn.textContent = this.sfxEnabled ? 'üîä SFX' : 'üîá SFX';
                console.log(this.sfxEnabled ? 'üîä Suoni player ON' : 'üîá Suoni player OFF');
            }
        };

        // === CONFIGURA FIREBASE ===
        const firebaseConfig = {
            apiKey: "AIzaSyC-RrLKSwfM-S5r1gD_RWdjWElWhkgp1vI",
            authDomain: "pigiamaparty2-b8d66.firebaseapp.com",
            databaseURL: "https://pigiamaparty2-b8d66-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "pigiamaparty2-b8d66",
            storageBucket: "pigiamaparty2-b8d66.firebasestorage.app",
            messagingSenderId: "300420666102",
            appId: "1:300420666102:web:4170ec1ba37673b88652d7"
        };

        // Inizializza Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // === VARIABILI DI STATO ===
        let gameCode = '';
        let playerName = '';
        let currentQuestionIndex = -1;
        let selectedAnswer = null;
        let timeLeft = 20;
        let timer;
        let playerScore = 0;
        let currentQuestionData = null;
        let hasSubmitted = false;

        // === ELEMENTI DOM ===
        const elements = {
            initialScreen: document.getElementById('initialScreen'),
            waitingScreen: document.getElementById('waitingScreen'),
            questionScreen: document.getElementById('questionScreen'),
            answerSubmittedScreen: document.getElementById('answerSubmittedScreen'),
            questionResultScreen: document.getElementById('questionResultScreen'),
            leaderboardScreen: document.getElementById('leaderboardScreen'),
            gameCodeInput: document.getElementById('gameCodeInput'),
            playerName: document.getElementById('playerName'),
            joinBtn: document.getElementById('joinBtn'),
            gameCodeDisplay: document.getElementById('gameCodeDisplay'),
            waitingMessage: document.getElementById('waitingMessage'),
            playerNameDisplay: document.getElementById('playerNameDisplay'),
            questionNumber: document.getElementById('questionNumber'),
            questionText: document.getElementById('questionText'),
            timer: document.getElementById('timer'),
            answersContainer: document.getElementById('answersContainer'),
            selectedAnswerText: document.getElementById('selectedAnswerText'),
            leaderboardList: document.getElementById('leaderboardList'),
            playerScore: document.getElementById('playerScore'),
            resultContainer: document.getElementById('resultContainer'),
            resultCard: document.getElementById('resultCard'),
            waitingHostMessage: document.getElementById('waitingHostMessage')
        };

        // === FUNZIONI PRINCIPALI ===
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            
            setTimeout(() => {
                const targetScreen = document.getElementById(screenId);
                if (targetScreen) {
                    targetScreen.classList.remove('hidden');
                    audio.playSFX('transitionSound');
                }
            }, 50);
        }

        function joinGame() {
            gameCode = elements.gameCodeInput.value.trim().toUpperCase();
            playerName = elements.playerName.value.trim();
            
            if (!gameCode || !playerName) {
                alert('Please enter both game code and your name!');
                return;
            }

            audio.playSFX('clickSound');
            
            elements.gameCodeDisplay.textContent = gameCode;
            elements.playerNameDisplay.textContent = playerName;
            
            database.ref('games/' + gameCode + '/players').push({
                name: playerName,
                joinedAt: Date.now()
            });

            // ASCOLTA LO STATO DEL GIOCO PRINCIPALE
            database.ref('games/' + gameCode).on('value', (snapshot) => {
                const game = snapshot.val();
                if (!game) {
                    alert('Game not found! Check the code.');
                    return;
                }

                if (game.status === 'started') {
                    if (game.currentQuestion !== currentQuestionIndex) {
                        currentQuestionIndex = game.currentQuestion || 0;
                        console.log(`üéÆ Player: Nuova domanda ${currentQuestionIndex + 1}`);
                        selectedAnswer = null;
                        hasSubmitted = false;
                        showQuestionScreen();
                    }
                } else if (game.status === 'ended') {
                    showLeaderboard(game.leaderboard || []);
                }
                
                if (game.answersRevealed && game.currentQuestion === currentQuestionIndex) {
                    console.log('üéØ Host ha rivelato le risposte! Mostrando risultato...');
                    showQuestionResult();
                }
            });

            database.ref('games/' + gameCode + '/currentQuestionData').on('value', (snapshot) => {
                const question = snapshot.val();
                if (question && question.currentQuestion !== currentQuestionIndex) {
                    currentQuestionData = question;
                    showQuestion(question);
                }
            });

            database.ref('games/' + gameCode + '/leaderboard').on('value', (snapshot) => {
                const leaderboard = snapshot.val();
                if (leaderboard) {
                    console.log('üèÜ Leaderboard received:', leaderboard);
                    showLeaderboard(leaderboard);
                }
            });

            showScreen('waitingScreen');
        }

        function showQuestionScreen() {
            audio.playSFX('transitionSound');
            showScreen('questionScreen');
        }

function showQuestion(question) {
    currentQuestionIndex = question.currentQuestion || currentQuestionIndex;
    currentQuestionData = question;
    
    console.log(`üìù Player: Mostrando domanda ${currentQuestionIndex + 1}`, question);
    console.log(`üéØ Tipo domanda: ${question.type || 'multiple-choice'}`);
    
    selectedAnswer = null;
    hasSubmitted = false;
    
    elements.questionText.textContent = question.question;
    elements.questionNumber.textContent = `QUESTION ${currentQuestionIndex + 1}`;
    
    elements.answersContainer.innerHTML = '';
    
    // CONTROLLA SE √à UNA DOMANDA DI TIPO "ORDINE"
    if (question.type === 'order' || question.question.toLowerCase().includes('ordine') || 
        question.question.toLowerCase().includes('cronolog') || 
        question.question.toLowerCase().includes('sequenza')) {
        
        showOrderQuestion(question);
    } else {
        showMultipleChoiceQuestion(question);
    }
    
    showScreen('questionScreen');
    startTimer();
}

function showMultipleChoiceQuestion(question) {
    question.answers.forEach((answer, index) => {
        const button = document.createElement('button');
        button.className = 'answer-btn';
        button.textContent = answer;
        button.onclick = () => selectAnswer(index, answer);
        elements.answersContainer.appendChild(button);
    });
}

function showOrderQuestion(question) {
    const dragContainer = document.createElement('div');
    dragContainer.className = 'drag-drop-container';
    
    // Istruzioni
    const instructions = document.createElement('div');
    instructions.className = 'drag-instructions';
    instructions.textContent = 'Trascina le risposte per metterle nell\'ordine corretto (dal primo all\'ultimo)';
    dragContainer.appendChild(instructions);
    
    // Lista draggable
    const draggableList = document.createElement('ul');
    draggableList.className = 'draggable-list';
    draggableList.id = 'draggableList';
    
    // Mescola le risposte per iniziare (ma mantieni l'ordine originale per riferimento)
    const shuffledAnswers = [...question.answers];
    shuffleArray(shuffledAnswers);
    
    shuffledAnswers.forEach((answer, index) => {
        const li = document.createElement('li');
        li.className = 'draggable-item';
        li.draggable = true;
        li.dataset.answer = answer;
        li.dataset.originalIndex = question.answers.indexOf(answer);
        
        const orderIndicator = document.createElement('div');
        orderIndicator.className = 'order-indicator';
        orderIndicator.textContent = index + 1;
        
        const answerText = document.createElement('span');
        answerText.textContent = answer;
        
        li.appendChild(orderIndicator);
        li.appendChild(answerText);
        draggableList.appendChild(li);
    });
    
    dragContainer.appendChild(draggableList);
    
    // Bottone di conferma
    const submitButton = document.createElement('button');
    submitButton.className = 'submit-order-btn';
    submitButton.innerHTML = 'üéØ <span>CONFERMA ORDINE</span>';
    submitButton.onclick = submitOrderAnswer;
    
    dragContainer.appendChild(submitButton);
    elements.answersContainer.appendChild(dragContainer);
    
    // Inizializza drag and drop
    initDragAndDrop();
}

        function initDragAndDrop() {
    const draggableList = document.getElementById('draggableList');
    if (!draggableList) return;

    let draggedItem = null;

    // Eventi per desktop
    draggableList.querySelectorAll('.draggable-item').forEach(item => {
        item.addEventListener('dragstart', function(e) {
            draggedItem = this;
            setTimeout(() => this.classList.add('dragging'), 0);
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        });

        item.addEventListener('dragend', function() {
            this.classList.remove('dragging');
            draggedItem = null;
            updateOrderNumbers();
        });

        item.addEventListener('dragover', function(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        });

        item.addEventListener('dragenter', function(e) {
            e.preventDefault();
            this.classList.add('drag-over');
        });

        item.addEventListener('dragleave', function() {
            this.classList.remove('drag-over');
        });

        item.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            
            if (draggedItem && this !== draggedItem) {
                const allItems = Array.from(draggableList.querySelectorAll('.draggable-item'));
                const thisIndex = allItems.indexOf(this);
                const draggedIndex = allItems.indexOf(draggedItem);
                
                if (draggedIndex < thisIndex) {
                    this.parentNode.insertBefore(draggedItem, this.nextSibling);
                } else {
                    this.parentNode.insertBefore(draggedItem, this);
                }
                
                updateOrderNumbers();
                audio.playSFX('clickSound');
            }
        });
    });

    // Eventi per touch (mobile)
    let touchStartY = 0;
    let touchedItem = null;

    draggableList.querySelectorAll('.draggable-item').forEach(item => {
        item.addEventListener('touchstart', function(e) {
            touchedItem = this;
            touchStartY = e.touches[0].clientY;
            this.classList.add('dragging');
            e.preventDefault();
        });

        item.addEventListener('touchmove', function(e) {
            if (!touchedItem) return;
            
            const touchY = e.touches[0].clientY;
            const deltaY = touchY - touchStartY;
            
            // Sposta l'elemento
            this.style.transform = `translateY(${deltaY}px)`;
            
            // Trova l'elemento su cui siamo passati
            const allItems = Array.from(draggableList.querySelectorAll('.draggable-item:not(.dragging)'));
            const touchElement = document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY);
            const targetItem = touchElement ? touchElement.closest('.draggable-item') : null;
            
            if (targetItem && targetItem !== touchedItem) {
                const allItemsWithDragging = Array.from(draggableList.querySelectorAll('.draggable-item'));
                const thisIndex = allItemsWithDragging.indexOf(targetItem);
                const touchedIndex = allItemsWithDragging.indexOf(touchedItem);
                
                if (touchedIndex < thisIndex) {
                    targetItem.parentNode.insertBefore(touchedItem, targetItem.nextSibling);
                } else {
                    targetItem.parentNode.insertBefore(touchedItem, targetItem);
                }
                
                updateOrderNumbers();
            }
            
            e.preventDefault();
        });

        item.addEventListener('touchend', function() {
            if (touchedItem) {
                touchedItem.classList.remove('dragging');
                touchedItem.style.transform = '';
                touchedItem = null;
                audio.playSFX('clickSound');
            }
        });
    });
}

function updateOrderNumbers() {
    const draggableList = document.getElementById('draggableList');
    if (!draggableList) return;
    
    const items = draggableList.querySelectorAll('.draggable-item');
    items.forEach((item, index) => {
        const orderIndicator = item.querySelector('.order-indicator');
        if (orderIndicator) {
            orderIndicator.textContent = index + 1;
        }
    });
}

function submitOrderAnswer() {
    if (hasSubmitted) return;
    
    const draggableList = document.getElementById('draggableList');
    if (!draggableList) return;
    
    const items = draggableList.querySelectorAll('.draggable-item');
    const submittedOrder = Array.from(items).map(item => parseInt(item.dataset.originalIndex));
    
    console.log('üìã Ordine inviato:', submittedOrder);
    
    selectedAnswer = submittedOrder;
    elements.selectedAnswerText.textContent = `Ordine: ${submittedOrder.map(i => i + 1).join(' ‚Üí ')}`;
    
    audio.playSFX('submitSound');
    hasSubmitted = true;
    
    const answerTime = 20 - timeLeft;
    
    database.ref('games/' + gameCode + '/answers').push({
        playerName: playerName,
        answerIndex: submittedOrder, // Per domande di ordine, inviamo l'array
        questionIndex: currentQuestionIndex,
        answerTime: answerTime,
        isOrderQuestion: true
    });

    setTimeout(() => {
        showScreen('answerSubmittedScreen');
    }, 500);
}
        
// Funzione per mescolare array
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function selectAnswer(index, answerText) {
    if (hasSubmitted) return;
    
    // Se √® una domanda di ordine, usa il bottone di conferma invece della selezione diretta
    if (currentQuestionData && (currentQuestionData.type === 'order' || 
        currentQuestionData.question.toLowerCase().includes('ordine') || 
        currentQuestionData.question.toLowerCase().includes('cronolog') || 
        currentQuestionData.question.toLowerCase().includes('sequenza'))) {
        return; // Le domande di ordine usano submitOrderAnswer
    }
    
    audio.playSFX('clickSound');
    
    document.querySelectorAll('.answer-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
    
    const selectedButton = document.querySelectorAll('.answer-btn')[index];
    selectedButton.classList.add('selected');
    selectedButton.classList.add('auto-submitted');
    
    selectedAnswer = index;
    elements.selectedAnswerText.textContent = answerText;
    
    // EFFETTO VISIVO: Particele quando si seleziona risposta
    const rect = selectedButton.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    createCelebrationParticles(centerX, centerY, 10);
    
    submitAnswer();
}

        function submitAnswer() {
            if (selectedAnswer === null || hasSubmitted) return;
            
            audio.playSFX('submitSound');
            hasSubmitted = true;
            
            const answerTime = 20 - timeLeft;
            console.log(`‚è±Ô∏è Answer time: ${answerTime}s (bonus: ${answerTime <= 5 ? 'YES' : 'NO'})`);
            
            database.ref('games/' + gameCode + '/answers').push({
                playerName: playerName,
                answerIndex: selectedAnswer,
                questionIndex: currentQuestionIndex,
                answerTime: answerTime
            });

            setTimeout(() => {
                showScreen('answerSubmittedScreen');
            }, 500);
        }

        function startTimer() {
            timeLeft = 20;
            elements.timer.textContent = timeLeft;
            elements.timer.classList.remove('warning');
            
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                elements.timer.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    if (selectedAnswer !== null && !hasSubmitted) {
                        submitAnswer();
                    } else if (!hasSubmitted) {
                        showScreen('answerSubmittedScreen');
                    }
                }
            }, 1000);
        }

function showQuestionResult() {
    if (!currentQuestionData || selectedAnswer === null) {
        console.log('‚ùå Dati mancanti per mostrare il risultato');
        return;
    }
    
    let isCorrect = false;
    
    // Gestione diversa per domande di ordine vs multiple choice
    if (Array.isArray(selectedAnswer)) {
        // Domanda di ordine - confronta gli array
        const correctOrder = Array.from({length: currentQuestionData.answers.length}, (_, i) => i);
        isCorrect = JSON.stringify(selectedAnswer) === JSON.stringify(correctOrder);
        console.log(`üéØ Risultato ordine: ${isCorrect ? 'CORRETTO' : 'SBAGLIATO'}`, {
            submitted: selectedAnswer,
            correct: correctOrder
        });
    } else {
        // Domanda multiple choice normale
        isCorrect = selectedAnswer === currentQuestionData.correct;
    }
    
    const answerTime = 20 - (timeLeft > 0 ? timeLeft : 0);
    const basePoints = currentQuestionData.points || 10;
    const speedBonus = (answerTime <= 5) ? (6 - answerTime) : 0;
    const totalPoints = isCorrect ? (basePoints + speedBonus) : 0;
    
    console.log(`üéØ Risultato: ${isCorrect ? 'CORRETTO' : 'SBAGLIATO'}, Punti: ${totalPoints}`);
    
    clearInterval(timer);
    
    let resultHTML = '';
    
    if (isCorrect) {
        resultHTML = `
            <div class="result-icon">üéâ</div>
            <div class="result-title correct-title">CORRECT!</div>
            <div class="result-message">${Array.isArray(selectedAnswer) ? 'Perfect sequence! You got the order right!' : 'Brilliant answer! You nailed it!'}</div>
            <div class="points-earned correct-points">
                +${totalPoints} POINTS
                ${speedBonus > 0 ? `<div style="font-size: 1rem; margin-top: 5px;">‚ö° +${speedBonus} speed bonus!</div>` : ''}
            </div>
        `;
        elements.resultCard.className = 'tv-card correct-result';
        
        audio.playSFX('applauseSound');
        createConfetti();
        createCelebrationParticles(window.innerWidth / 2, window.innerHeight / 2, 30);
        
    } else {
        let correctAnswerText = '';
        if (Array.isArray(selectedAnswer)) {
            const correctOrder = Array.from({length: currentQuestionData.answers.length}, (_, i) => i);
            correctAnswerText = `Correct order: ${correctOrder.map(i => currentQuestionData.answers[i]).join(' ‚Üí ')}`;
        } else {
            correctAnswerText = `The correct answer was: <strong>${currentQuestionData.answers[currentQuestionData.correct]}</strong>`;
        }
        
        resultHTML = `
            <div class="result-icon">üí®</div>
            <div class="result-title wrong-title">WRONG!</div>
            <div class="result-message">Better luck next time! ${correctAnswerText}</div>
            <div class="points-earned wrong-points">
                0 POINTS
            </div>
        `;
        elements.resultCard.className = 'tv-card wrong-result';
        
        audio.playSFX('fartSound');
    }
    
    elements.resultContainer.innerHTML = resultHTML;
    showScreen('questionResultScreen');
}

        function showLeaderboard(leaderboard) {
            if (!leaderboard || leaderboard.length === 0) {
                console.log('‚ùå Empty or invalid leaderboard');
                return;
            }
            
            audio.playSFX('transitionSound');
            
            console.log('üìä Showing leaderboard:', leaderboard);
            
            elements.leaderboardList.innerHTML = '';
            
            leaderboard.forEach((player, index) => {
                const li = document.createElement('li');
                li.className = 'leaderboard-item';
                
                let rankIcon = '';
                if (index === 0) rankIcon = 'ü•á ';
                else if (index === 1) rankIcon = 'ü•à ';
                else if (index === 2) rankIcon = 'ü•â ';
                
                li.innerHTML = `
                    <span class="rank">${rankIcon}${index + 1}¬∞</span>
                    <span class="name">${player.name}</span>
                    <span class="score">${player.score || 0}P</span>
                `;
                elements.leaderboardList.appendChild(li);
                
                if (player.name === playerName) {
                    playerScore = player.score || 0;
                    elements.playerScore.textContent = `${playerScore} POINTS`;
                }
            });
            
            showScreen('leaderboardScreen');
        }

        // === EVENT LISTENERS ===
        elements.joinBtn.addEventListener('click', joinGame);

        document.addEventListener('click', function initAudio() {
            if (!audio.audioActivated) {
                audio.activateAudio();
            }
        }, { once: true });

        document.getElementById('sfxToggle').addEventListener('click', function() {
            audio.toggleSFX();
        });

        elements.gameCodeInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') joinGame();
        });
        elements.playerName.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') joinGame();
        });

        // === INIZIALIZZAZIONE ===
        createParticles();
        console.log('üéÆ Player Game Show Edition v2.0 ready!');
        
        setTimeout(() => {
            document.title = "Pigiama Party - Contestant";
        }, 100);
    </script>
</body>
</html>

